<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE OverloadedStrings #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-3"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">RoleSelfAssign</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="RoleSelfAssign.html#reactionAddReceivers"><span class="hs-identifier">reactionAddReceivers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RoleSelfAssign.html#reactionRemReceivers"><span class="hs-identifier">reactionRemReceivers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="RoleSelfAssign.html#receivers"><span class="hs-identifier">receivers</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Discord</span></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">restCall</span></span><span>
</span><span id="line-6"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">DiscordHandler</span></span><span>
</span><span id="line-7"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Discord.Types</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Emoji</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">emojiName</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ReactionInfo</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">reactionEmoji</span></span><span>
</span><span id="line-10"></span><span>                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reactionUserId</span></span><span>
</span><span id="line-11"></span><span>                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">reactionMessageId</span></span><span>
</span><span id="line-12"></span><span>                                                       </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">MessageId</span></span><span>
</span><span id="line-14"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Message</span></span><span>
</span><span id="line-15"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">messageId</span></span><span>
</span><span id="line-16"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">RoleId</span></span><span>
</span><span id="line-17"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Role</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">roleName</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">roleId</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">GuildId</span></span><span>
</span><span id="line-19"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">messageChannel</span></span><span>
</span><span id="line-20"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Discord.Requests</span></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">GuildRequest</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">RemoveGuildMemberRole</span></span><span>
</span><span id="line-22"></span><span>                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">AddGuildMemberRole</span></span><span>
</span><span id="line-23"></span><span>                                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">GetGuildRoles</span></span><span>
</span><span id="line-24"></span><span>                                                       </span><span class="hs-special">)</span><span>
</span><span id="line-25"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">ChannelRequest</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">CreateMessage</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-27"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Control.Monad</span></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">guard</span></span><span>
</span><span id="line-28"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unless</span></span><span>
</span><span id="line-29"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">forM_</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">UnliftIO</span></span><span>               </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">liftIO</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Bifunctor</span></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">first</span></span><span>
</span><span id="line-32"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">bimap</span></span><span>
</span><span id="line-33"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Char</span></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">isDigit</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span>             </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">fromJust</span></span><span>
</span><span id="line-36"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isJust</span></span><span>
</span><span id="line-37"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">isNothing</span></span><span>
</span><span id="line-38"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">toUpper</span></span><span>
</span><span id="line-40"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unpack</span></span><span>
</span><span id="line-41"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">pack</span></span><span>
</span><span id="line-42"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">Text</span></span><span>
</span><span id="line-43"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">tail</span></span><span>
</span><span id="line-44"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unlines</span></span><span>
</span><span id="line-45"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span>          </span><span class="annot"><span class="hs-identifier">Data.Text.Encoding</span></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">encodeUtf8</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span>          </span><span class="annot"><span class="hs-identifier">Data.ByteString.Lazy</span></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">fromStrict</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Owoifier.html"><span class="hs-identifier">Owoifier</span></a></span><span>               </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Owoifier.html#owoify"><span class="hs-identifier">owoify</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Utils.html"><span class="hs-identifier">Utils</span></a></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Utils.html#sendMessageDM"><span class="hs-identifier">sendMessageDM</span></a></span><span>
</span><span id="line-52"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Utils.html#newCommand"><span class="hs-identifier">newCommand</span></a></span><span>
</span><span id="line-53"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Utils.html#isEmojiValid"><span class="hs-identifier">isEmojiValid</span></a></span><span>
</span><span id="line-54"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Utils.html#isRoleInGuild"><span class="hs-identifier">isRoleInGuild</span></a></span><span>
</span><span id="line-55"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Utils.html#sendMessageChan"><span class="hs-identifier">sendMessageChan</span></a></span><span>
</span><span id="line-56"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Utils.html#addReaction"><span class="hs-identifier">addReaction</span></a></span><span>
</span><span id="line-57"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="CSV.html"><span class="hs-identifier">CSV</span></a></span><span>                    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="CSV.html#readCSV"><span class="hs-identifier">readCSV</span></a></span><span>
</span><span id="line-59"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="CSV.html#readSingleColCSV"><span class="hs-identifier">readSingleColCSV</span></a></span><span>
</span><span id="line-60"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="CSV.html#addToCSV"><span class="hs-identifier">addToCSV</span></a></span><span>
</span><span id="line-61"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="CSV.html#writeCSV"><span class="hs-identifier">writeCSV</span></a></span><span>
</span><span id="line-62"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span>          </span><span class="annot"><a href="TemplateRE.html"><span class="hs-identifier">TemplateRE</span></a></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="TemplateRE.html#accoladedArgRE"><span class="hs-identifier">accoladedArgRE</span></a></span><span>
</span><span id="line-65"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="TemplateRE.html#quotedArgRE"><span class="hs-identifier">quotedArgRE</span></a></span><span>
</span><span id="line-66"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="TemplateRE.html#spaceRE"><span class="hs-identifier">spaceRE</span></a></span><span>
</span><span id="line-67"></span><span>                                        </span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span>          </span><span class="annot"><span class="hs-identifier">Data.Map</span></span><span>                </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-70"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">toList</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span>          </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span>              </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier">decode</span></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span>
</span><span id="line-73"></span><span class="annot"><a href="RoleSelfAssign.html#reactionAddReceivers"><span class="hs-identifier hs-type">reactionAddReceivers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ReactionInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-74"></span><span id="reactionAddReceivers"><span class="annot"><span class="annottext">reactionAddReceivers :: [ReactionInfo -&gt; DiscordHandler ()]
</span><a href="RoleSelfAssign.html#reactionAddReceivers"><span class="hs-identifier hs-var hs-var">reactionAddReceivers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; DiscordHandler ()
</span><a href="RoleSelfAssign.html#attemptRoleAssign"><span class="hs-identifier hs-var">attemptRoleAssign</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="annot"><a href="RoleSelfAssign.html#reactionRemReceivers"><span class="hs-identifier hs-type">reactionRemReceivers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">ReactionInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-77"></span><span id="reactionRemReceivers"><span class="annot"><span class="annottext">reactionRemReceivers :: [ReactionInfo -&gt; DiscordHandler ()]
</span><a href="RoleSelfAssign.html#reactionRemReceivers"><span class="hs-identifier hs-var hs-var">reactionRemReceivers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; DiscordHandler ()
</span><a href="RoleSelfAssign.html#handleRoleRemove"><span class="hs-identifier hs-var">handleRoleRemove</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="annot"><a href="RoleSelfAssign.html#receivers"><span class="hs-identifier hs-type">receivers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-80"></span><span id="receivers"><span class="annot"><span class="annottext">receivers :: [Message -&gt; DiscordHandler ()]
</span><a href="RoleSelfAssign.html#receivers"><span class="hs-identifier hs-var hs-var">receivers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Message -&gt; DiscordHandler ()
</span><a href="RoleSelfAssign.html#createAssignStation"><span class="hs-identifier hs-var">createAssignStation</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-83"></span><span>
</span><span id="line-84"></span><span class="annot"><a href="RoleSelfAssign.html#assignFilePath"><span class="hs-identifier hs-type">assignFilePath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">FilePath</span></span><span>
</span><span id="line-85"></span><span id="assignFilePath"><span class="annot"><span class="annottext">assignFilePath :: FilePath
</span><a href="RoleSelfAssign.html#assignFilePath"><span class="hs-identifier hs-var hs-var">assignFilePath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;idAssign.csv&quot;</span></span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span class="annot"><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-type">serverID</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">GuildId</span></span><span>
</span><span id="line-88"></span><span id="serverID"><span class="annot"><span class="annottext">serverID :: GuildId
</span><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-var hs-var">serverID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-number">755798054455738489</span></span><span>
</span><span id="line-89"></span><span class="hs-comment">-- the number is the fixed Guild/Server ID.</span><span>
</span><span id="line-90"></span><span class="hs-comment">-- TODO: put the number in a config file.</span><span>
</span><span id="line-91"></span><span class="hs-comment">-- Currently set to the testing server's.</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="annot"><a href="RoleSelfAssign.html#createAssignStationSyntax"><span class="hs-identifier hs-type">createAssignStationSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-94"></span><span id="createAssignStationSyntax"><span class="annot"><span class="annottext">createAssignStationSyntax :: Text
</span><a href="RoleSelfAssign.html#createAssignStationSyntax"><span class="hs-identifier hs-var hs-var">createAssignStationSyntax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="hs-string">&quot;Syntax: `:createSelfAssign \&quot;&lt;prependText&gt;\&quot; \&quot;&lt;appendText&gt;\&quot; &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span>
</span><span id="line-95"></span><span>                            </span><span class="annot"><span class="hs-string">&quot;{\&quot;emoji1\&quot;: \&quot;roleText1\&quot;, \&quot;emoji2\&quot;: \&quot;roleText2\&quot;, ...}`&quot;</span></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="RoleSelfAssign.html#roleIdToRole"><span class="hs-identifier hs-type">roleIdToRole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RoleId</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Role</span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-98"></span><span id="roleIdToRole"><span class="annot"><span class="annottext">roleIdToRole :: GuildId -&gt; [Role] -&gt; Text
</span><a href="RoleSelfAssign.html#roleIdToRole"><span class="hs-identifier hs-var hs-var">roleIdToRole</span></a></span></span><span> </span><span id="local-6989586621679186380"><span class="annot"><span class="annottext">rid :: GuildId
</span><a href="#local-6989586621679186380"><span class="hs-identifier hs-var">rid</span></a></span></span><span> </span><span id="local-6989586621679186379"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621679186379"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role -&gt; Text
</span><span class="hs-identifier hs-var hs-var">roleName</span></span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Text) -&gt; ([Role] -&gt; Role) -&gt; [Role] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; Role
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([Role] -&gt; Text) -&gt; [Role] -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Role -&gt; Bool) -&gt; [Role] -&gt; [Role]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">filter</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679186376"><span class="annot"><span class="annottext">r :: Role
</span><a href="#local-6989586621679186376"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Role -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">roleId</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621679186376"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; GuildId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186380"><span class="hs-identifier hs-var">rid</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621679186379"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-99"></span><span>
</span><span id="line-100"></span><span class="annot"><a href="RoleSelfAssign.html#formatAssignStation"><span class="hs-identifier hs-type">formatAssignStation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RoleId</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span>
</span><span id="line-101"></span><span id="formatAssignStation"><span class="annot"><span class="annottext">formatAssignStation :: Text -&gt; Text -&gt; [(Text, GuildId)] -&gt; DiscordHandler Text
</span><a href="RoleSelfAssign.html#formatAssignStation"><span class="hs-identifier hs-var hs-var">formatAssignStation</span></a></span></span><span> </span><span id="local-6989586621679186374"><span class="annot"><span class="annottext">prependT :: Text
</span><a href="#local-6989586621679186374"><span class="hs-identifier hs-var">prependT</span></a></span></span><span> </span><span id="local-6989586621679186373"><span class="annot"><span class="annottext">appendT :: Text
</span><a href="#local-6989586621679186373"><span class="hs-identifier hs-var">appendT</span></a></span></span><span> </span><span id="local-6989586621679186372"><span class="annot"><span class="annottext">options :: [(Text, GuildId)]
</span><a href="#local-6989586621679186372"><span class="hs-identifier hs-var">options</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679186371"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621679186371"><span class="hs-identifier hs-var">roles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GuildRequest [Role]
-&gt; DiscordHandler (Either RestCallErrorCode [Role])
forall a (r :: * -&gt; *).
(FromJSON a, Request (r a)) =&gt;
r a -&gt; DiscordHandler (Either RestCallErrorCode a)
</span><span class="hs-identifier hs-var">restCall</span></span><span> </span><span class="annot"><span class="annottext">(GuildRequest [Role]
 -&gt; DiscordHandler (Either RestCallErrorCode [Role]))
-&gt; GuildRequest [Role]
-&gt; DiscordHandler (Either RestCallErrorCode [Role])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; GuildRequest [Role]
</span><span class="hs-identifier hs-var">GetGuildRoles</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-var">serverID</span></a></span><span>
</span><span id="line-103"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186370"><span class="annot"><span class="annottext">roleTextOptions :: [(Text, Text)]
</span><a href="#local-6989586621679186370"><span class="hs-identifier hs-var hs-var">roleTextOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679186369"><span class="annot"><span class="annottext">emojiT :: Text
</span><a href="#local-6989586621679186369"><span class="hs-identifier hs-var">emojiT</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186368"><span class="annot"><span class="annottext">roleID :: GuildId
</span><a href="#local-6989586621679186368"><span class="hs-identifier hs-var">roleID</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186369"><span class="hs-identifier hs-var">emojiT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; [Role] -&gt; Text
</span><a href="RoleSelfAssign.html#roleIdToRole"><span class="hs-identifier hs-var">roleIdToRole</span></a></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186368"><span class="hs-identifier hs-var">roleID</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621679186371"><span class="hs-identifier hs-var">roles</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text, GuildId) -&gt; (Text, Text))
-&gt; [(Text, GuildId)] -&gt; [(Text, Text)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186372"><span class="hs-identifier hs-var">options</span></a></span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186366"><span class="annot"><span class="annottext">optionsT :: [Text]
</span><a href="#local-6989586621679186366"><span class="hs-identifier hs-var hs-var">optionsT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679186365"><span class="annot"><span class="annottext">emoji :: Text
</span><a href="#local-6989586621679186365"><span class="hs-identifier hs-var">emoji</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186364"><span class="annot"><span class="annottext">roleName :: Text
</span><a href="#local-6989586621679186364"><span class="hs-identifier hs-var">roleName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-105"></span><span>                        </span><span class="annot"><span class="hs-string">&quot;`[`&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186365"><span class="hs-identifier hs-var">emoji</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;`]` for &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;`[`&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186364"><span class="hs-identifier hs-var">roleName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;`]`&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>                    </span><span class="annot"><span class="annottext">((Text, Text) -&gt; Text) -&gt; [(Text, Text)] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621679186370"><span class="hs-identifier hs-var">roleTextOptions</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">Text -&gt; DiscordHandler Text
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; DiscordHandler Text) -&gt; Text -&gt; DiscordHandler Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-108"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186374"><span class="hs-identifier hs-var">prependT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>            </span><span class="annot"><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>            </span><span class="annot"><span class="annottext">[Text] -&gt; Text
</span><span class="hs-identifier hs-var">T.unlines</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186366"><span class="hs-identifier hs-var">optionsT</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>            </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186373"><span class="hs-identifier hs-var">appendT</span></a></span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span class="annot"><a href="RoleSelfAssign.html#createAssignStation"><span class="hs-identifier hs-type">createAssignStation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Message</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span id="createAssignStation"><span class="annot"><span class="annottext">createAssignStation :: Message -&gt; DiscordHandler ()
</span><a href="RoleSelfAssign.html#createAssignStation"><span class="hs-identifier hs-var hs-var">createAssignStation</span></a></span></span><span> </span><span id="local-6989586621679186363"><span class="annot"><span class="annottext">m :: Message
</span><a href="#local-6989586621679186363"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message
-&gt; Text -&gt; ([Text] -&gt; DiscordHandler ()) -&gt; DiscordHandler ()
</span><a href="Utils.html#newCommand"><span class="hs-identifier hs-var">newCommand</span></a></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186363"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-string">&quot;createSelfAssign &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="TemplateRE.html#quotedArgRE"><span class="hs-identifier hs-var">quotedArgRE</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="TemplateRE.html#spaceRE"><span class="hs-identifier hs-var">spaceRE</span></a></span><span>
</span><span id="line-116"></span><span>                                                          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="TemplateRE.html#quotedArgRE"><span class="hs-identifier hs-var">quotedArgRE</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="TemplateRE.html#spaceRE"><span class="hs-identifier hs-var">spaceRE</span></a></span><span>
</span><span id="line-117"></span><span>                                                          </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="TemplateRE.html#accoladedArgRE"><span class="hs-identifier hs-var">accoladedArgRE</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Text] -&gt; DiscordHandler ()) -&gt; DiscordHandler ())
-&gt; ([Text] -&gt; DiscordHandler ()) -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679186362"><span class="annot"><span class="annottext">captures :: [Text]
</span><a href="#local-6989586621679186362"><span class="hs-identifier hs-var">captures</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-118"></span><span>    </span><span class="hs-comment">-- Captures are [arg1, arg2, json]</span><span>
</span><span id="line-119"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span id="local-6989586621679186361"><span class="annot"><span class="annottext">prependT :: Text
</span><a href="#local-6989586621679186361"><span class="hs-identifier hs-var">prependT</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186360"><span class="annot"><span class="annottext">appendT :: Text
</span><a href="#local-6989586621679186360"><span class="hs-identifier hs-var">appendT</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186359"><span class="annot"><span class="annottext">emojiRoleJson :: Text
</span><a href="#local-6989586621679186359"><span class="hs-identifier hs-var">emojiRoleJson</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186362"><span class="hs-identifier hs-var">captures</span></a></span><span>
</span><span id="line-120"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186358"><span class="annot"><span class="annottext">emojiRoleMapM :: Maybe (Map FilePath FilePath)
</span><a href="#local-6989586621679186358"><span class="hs-identifier hs-var hs-var">emojiRoleMapM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Maybe (Map FilePath FilePath)
forall a. FromJSON a =&gt; ByteString -&gt; Maybe a
</span><span class="hs-identifier hs-var">decode</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe (Map FilePath FilePath))
-&gt; (ByteString -&gt; ByteString)
-&gt; ByteString
-&gt; Maybe (Map FilePath FilePath)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><span class="hs-identifier hs-var">fromStrict</span></span><span> </span><span class="annot"><span class="annottext">(ByteString -&gt; Maybe (Map FilePath FilePath))
-&gt; ByteString -&gt; Maybe (Map FilePath FilePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; ByteString
</span><span class="hs-identifier hs-var">encodeUtf8</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186359"><span class="hs-identifier hs-var">emojiRoleJson</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Map</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span class="hs-special">)</span><span>
</span><span id="line-121"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Map FilePath FilePath)
</span><a href="#local-6989586621679186358"><span class="hs-identifier hs-var">emojiRoleMapM</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-122"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-123"></span><span>            </span><span class="hs-comment">-- LOGGING</span><span>
</span><span id="line-124"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; DiscordHandler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; DiscordHandler ()) -&gt; IO () -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186359"><span class="hs-identifier hs-var">emojiRoleJson</span></a></span><span>
</span><span id="line-125"></span><span>            </span><span class="annot"><span class="annottext">GuildId -&gt; Text -&gt; DiscordHandler ()
</span><a href="Utils.html#sendMessageChan"><span class="hs-identifier hs-var">sendMessageChan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">messageChannel</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186363"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; DiscordHandler ()) -&gt; Text -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-126"></span><span>                </span><span class="annot"><span class="hs-string">&quot;Invalid JSON. &quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="RoleSelfAssign.html#createAssignStationSyntax"><span class="hs-identifier hs-var">createAssignStationSyntax</span></a></span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679186356"><span class="annot"><span class="annottext">emojiRoleMap' :: Map FilePath FilePath
</span><a href="#local-6989586621679186356"><span class="hs-identifier hs-var">emojiRoleMap'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-128"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186355"><span class="annot"><span class="annottext">emojiRoleMap :: [(Text, Text)]
</span><a href="#local-6989586621679186355"><span class="hs-identifier hs-var hs-var">emojiRoleMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text)
-&gt; (FilePath -&gt; Text) -&gt; (FilePath, FilePath) -&gt; (Text, Text)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span><span class="hs-identifier hs-var">bimap</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">((FilePath, FilePath) -&gt; (Text, Text))
-&gt; [(FilePath, FilePath)] -&gt; [(Text, Text)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Map FilePath FilePath -&gt; [(FilePath, FilePath)]
forall k a. Map k a -&gt; [(k, a)]
</span><span class="hs-identifier hs-var">toList</span></span><span> </span><span class="annot"><span class="annottext">Map FilePath FilePath
</span><a href="#local-6989586621679186356"><span class="hs-identifier hs-var">emojiRoleMap'</span></a></span><span>
</span><span id="line-129"></span><span>            </span><span class="hs-comment">-- LOGGING</span><span>
</span><span id="line-130"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; DiscordHandler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; DiscordHandler ()) -&gt; IO () -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)] -&gt; IO ()
forall a. Show a =&gt; a -&gt; IO ()
</span><span class="hs-identifier hs-var">print</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621679186355"><span class="hs-identifier hs-var">emojiRoleMap</span></a></span><span>
</span><span id="line-131"></span><span>            </span><span id="local-6989586621679186354"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186354"><span class="hs-identifier hs-var">doEmojisExist</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><span class="hs-identifier hs-var">and</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool)
-&gt; ReaderT DiscordHandle IO [Bool] -&gt; ReaderT DiscordHandle IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[ReaderT DiscordHandle IO Bool] -&gt; ReaderT DiscordHandle IO [Bool]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679186351"><span class="annot"><span class="annottext">emoji :: Text
</span><a href="#local-6989586621679186351"><span class="hs-identifier hs-var">emoji</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Text -&gt; GuildId -&gt; ReaderT DiscordHandle IO Bool
</span><a href="Utils.html#isEmojiValid"><span class="hs-identifier hs-var">isEmojiValid</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186351"><span class="hs-identifier hs-var">emoji</span></a></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-var">serverID</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text, Text) -&gt; ReaderT DiscordHandle IO Bool)
-&gt; [(Text, Text)] -&gt; [ReaderT DiscordHandle IO Bool]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621679186355"><span class="hs-identifier hs-var">emojiRoleMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler () -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186354"><span class="hs-identifier hs-var">doEmojisExist</span></a></span><span>
</span><span id="line-133"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GuildId -&gt; Text -&gt; DiscordHandler ()
</span><a href="Utils.html#sendMessageChan"><span class="hs-identifier hs-var">sendMessageChan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">messageChannel</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186363"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>                </span><span class="annot"><span class="hs-string">&quot;One of the emojis provided is invalid. Perhaps you used one from another server?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186354"><span class="hs-identifier hs-var">doEmojisExist</span></a></span><span>
</span><span id="line-136"></span><span>            </span><span class="hs-comment">-- Emojis are fine!</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>            </span><span id="local-6989586621679186350"><span class="annot"><span class="annottext">[(Text, Maybe GuildId)]
</span><a href="#local-6989586621679186350"><span class="hs-identifier hs-var">emojiRoleIDMMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ReaderT DiscordHandle IO (Text, Maybe GuildId)]
-&gt; ReaderT DiscordHandle IO [(Text, Maybe GuildId)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><span class="hs-identifier hs-var">sequence</span></span><span> </span><span class="annot"><span class="annottext">([ReaderT DiscordHandle IO (Text, Maybe GuildId)]
 -&gt; ReaderT DiscordHandle IO [(Text, Maybe GuildId)])
-&gt; [ReaderT DiscordHandle IO (Text, Maybe GuildId)]
-&gt; ReaderT DiscordHandle IO [(Text, Maybe GuildId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679186349"><span class="annot"><span class="annottext">emoji :: Text
</span><a href="#local-6989586621679186349"><span class="hs-identifier hs-var">emoji</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186348"><span class="annot"><span class="annottext">roleFragment :: Text
</span><a href="#local-6989586621679186348"><span class="hs-identifier hs-var">roleFragment</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-139"></span><span>                                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186349"><span class="hs-identifier hs-var">emoji</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Maybe GuildId -&gt; (Text, Maybe GuildId))
-&gt; ReaderT DiscordHandle IO (Maybe GuildId)
-&gt; ReaderT DiscordHandle IO (Text, Maybe GuildId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; GuildId -&gt; ReaderT DiscordHandle IO (Maybe GuildId)
</span><a href="Utils.html#isRoleInGuild"><span class="hs-identifier hs-var">isRoleInGuild</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186348"><span class="hs-identifier hs-var">roleFragment</span></a></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-var">serverID</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text, Text) -&gt; ReaderT DiscordHandle IO (Text, Maybe GuildId))
-&gt; [(Text, Text)]
-&gt; [ReaderT DiscordHandle IO (Text, Maybe GuildId)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Text)]
</span><a href="#local-6989586621679186355"><span class="hs-identifier hs-var">emojiRoleMap</span></a></span><span>
</span><span id="line-140"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186347"><span class="annot"><span class="annottext">doRolesExist :: Bool
</span><a href="#local-6989586621679186347"><span class="hs-identifier hs-var hs-var">doRolesExist</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">((Text, Maybe GuildId) -&gt; Bool) -&gt; [(Text, Maybe GuildId)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">any</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186344"><span class="annot"><span class="annottext">roleIDM :: Maybe GuildId
</span><a href="#local-6989586621679186344"><span class="hs-identifier hs-var">roleIDM</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe GuildId -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isNothing</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId
</span><a href="#local-6989586621679186344"><span class="hs-identifier hs-var">roleIDM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, Maybe GuildId)]
</span><a href="#local-6989586621679186350"><span class="hs-identifier hs-var">emojiRoleIDMMap</span></a></span><span>
</span><span id="line-141"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler () -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186347"><span class="hs-identifier hs-var">doRolesExist</span></a></span><span>
</span><span id="line-142"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GuildId -&gt; Text -&gt; DiscordHandler ()
</span><a href="Utils.html#sendMessageChan"><span class="hs-identifier hs-var">sendMessageChan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">messageChannel</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186363"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span>                </span><span class="annot"><span class="hs-string">&quot;One of the roles provided is invalid. Please make sure you use the roles' names!&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186347"><span class="hs-identifier hs-var">doRolesExist</span></a></span><span>
</span><span id="line-145"></span><span>            </span><span class="hs-comment">-- Roles are fine!</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>            </span><span class="hs-comment">-- The map below is sanitised and perfectly safe to use.</span><span>
</span><span id="line-148"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186343"><span class="annot"><span class="annottext">emojiRoleIDMap :: [(Text, GuildId)]
</span><a href="#local-6989586621679186343"><span class="hs-identifier hs-var hs-var">emojiRoleIDMap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679186342"><span class="annot"><span class="annottext">emoji :: Text
</span><a href="#local-6989586621679186342"><span class="hs-identifier hs-var">emoji</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679186341"><span class="annot"><span class="annottext">roleID :: GuildId
</span><a href="#local-6989586621679186341"><span class="hs-identifier hs-var">roleID</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186342"><span class="hs-identifier hs-var">emoji</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186341"><span class="hs-identifier hs-var">roleID</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text, Maybe GuildId) -&gt; (Text, GuildId))
-&gt; [(Text, Maybe GuildId)] -&gt; [(Text, GuildId)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, Maybe GuildId)]
</span><a href="#local-6989586621679186350"><span class="hs-identifier hs-var">emojiRoleIDMMap</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-comment">-- Post the assignment station text.</span><span>
</span><span id="line-151"></span><span>            </span><span id="local-6989586621679186340"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186340"><span class="hs-identifier hs-var">assignStationT</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; [(Text, GuildId)] -&gt; DiscordHandler Text
</span><a href="RoleSelfAssign.html#formatAssignStation"><span class="hs-identifier hs-var">formatAssignStation</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186361"><span class="hs-identifier hs-var">prependT</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186360"><span class="hs-identifier hs-var">appendT</span></a></span><span> </span><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186343"><span class="hs-identifier hs-var">emojiRoleIDMap</span></a></span><span>
</span><span id="line-152"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679186339"><span class="annot"><span class="annottext">newMessage :: Message
</span><a href="#local-6989586621679186339"><span class="hs-identifier hs-var">newMessage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ChannelRequest Message
-&gt; DiscordHandler (Either RestCallErrorCode Message)
forall a (r :: * -&gt; *).
(FromJSON a, Request (r a)) =&gt;
r a -&gt; DiscordHandler (Either RestCallErrorCode a)
</span><span class="hs-identifier hs-var">restCall</span></span><span> </span><span class="annot"><span class="annottext">(ChannelRequest Message
 -&gt; DiscordHandler (Either RestCallErrorCode Message))
-&gt; ChannelRequest Message
-&gt; DiscordHandler (Either RestCallErrorCode Message)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; Text -&gt; ChannelRequest Message
</span><span class="hs-identifier hs-var">CreateMessage</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">messageChannel</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186363"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186340"><span class="hs-identifier hs-var">assignStationT</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186338"><span class="annot"><span class="annottext">assignStationID :: GuildId
</span><a href="#local-6989586621679186338"><span class="hs-identifier hs-var hs-var">assignStationID</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Message -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">messageId</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186339"><span class="hs-identifier hs-var">newMessage</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-comment">-- Make Owen react to the self-assignment station.</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186337"><span class="annot"><span class="annottext">emojiList :: [Text]
</span><a href="#local-6989586621679186337"><span class="hs-identifier hs-var hs-var">emojiList</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Text, GuildId) -&gt; Text
forall a b. (a, b) -&gt; a
</span><span class="hs-identifier hs-var">fst</span></span><span> </span><span class="annot"><span class="annottext">((Text, GuildId) -&gt; Text) -&gt; [(Text, GuildId)] -&gt; [Text]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186343"><span class="hs-identifier hs-var">emojiRoleIDMap</span></a></span><span>
</span><span id="line-157"></span><span>            </span><span class="annot"><span class="annottext">[Text] -&gt; (Text -&gt; DiscordHandler ()) -&gt; DiscordHandler ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><span class="hs-identifier hs-var">forM_</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186337"><span class="hs-identifier hs-var">emojiList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GuildId -&gt; GuildId -&gt; Text -&gt; DiscordHandler ()
</span><a href="Utils.html#addReaction"><span class="hs-identifier hs-var">addReaction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">messageChannel</span></span><span> </span><span class="annot"><span class="annottext">Message
</span><a href="#local-6989586621679186339"><span class="hs-identifier hs-var">newMessage</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186338"><span class="hs-identifier hs-var">assignStationID</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>            </span><span class="hs-comment">-- Hence, the map is fine. Write the mapping to the idAssign file :)</span><span>
</span><span id="line-160"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186336"><span class="annot"><span class="annottext">newFileName :: FilePath
</span><a href="#local-6989586621679186336"><span class="hs-identifier hs-var hs-var">newFileName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186338"><span class="hs-identifier hs-var">assignStationID</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="hs-string">&quot;.selfAssign&quot;</span></span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-comment">-- Add the new assign file to the CSV</span><span>
</span><span id="line-162"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; DiscordHandler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; DiscordHandler ()) -&gt; IO () -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [[Text]] -&gt; IO ()
</span><a href="CSV.html#addToCSV"><span class="hs-identifier hs-var">addToCSV</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="RoleSelfAssign.html#assignFilePath"><span class="hs-identifier hs-var">assignFilePath</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; FilePath -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186338"><span class="hs-identifier hs-var">assignStationID</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679186336"><span class="hs-identifier hs-var">newFileName</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-163"></span><span>            </span><span class="hs-comment">-- Write the mapping to the newly added CSV</span><span>
</span><span id="line-164"></span><span>            </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; DiscordHandler ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; DiscordHandler ())
-&gt; ([[Text]] -&gt; IO ()) -&gt; [[Text]] -&gt; DiscordHandler ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [[Text]] -&gt; IO ()
</span><a href="CSV.html#writeCSV"><span class="hs-identifier hs-var">writeCSV</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621679186336"><span class="hs-identifier hs-var">newFileName</span></a></span><span> </span><span class="annot"><span class="annottext">([[Text]] -&gt; DiscordHandler ()) -&gt; [[Text]] -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621679186334"><span class="annot"><span class="annottext">key :: Text
</span><a href="#local-6989586621679186334"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679186333"><span class="annot"><span class="annottext">value :: GuildId
</span><a href="#local-6989586621679186333"><span class="hs-identifier hs-var">value</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186334"><span class="hs-identifier hs-var">key</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Text) -&gt; FilePath -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186333"><span class="hs-identifier hs-var">value</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Text, GuildId) -&gt; [Text]) -&gt; [(Text, GuildId)] -&gt; [[Text]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186343"><span class="hs-identifier hs-var">emojiRoleIDMap</span></a></span><span>
</span><span id="line-165"></span><span>            </span><span class="annot"><span class="annottext">() -&gt; DiscordHandler ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="annot"><a href="RoleSelfAssign.html#isOnAssignMessage"><span class="hs-identifier hs-type">isOnAssignMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReactionInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-168"></span><span id="isOnAssignMessage"><span class="annot"><span class="annottext">isOnAssignMessage :: ReactionInfo -&gt; ReaderT DiscordHandle IO Bool
</span><a href="RoleSelfAssign.html#isOnAssignMessage"><span class="hs-identifier hs-var hs-var">isOnAssignMessage</span></a></span></span><span> </span><span id="local-6989586621679186331"><span class="annot"><span class="annottext">r :: ReactionInfo
</span><a href="#local-6989586621679186331"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679186330"><span class="annot"><span class="annottext">[GuildId]
</span><a href="#local-6989586621679186330"><span class="hs-identifier hs-var">validMessages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [GuildId] -&gt; ReaderT DiscordHandle IO [GuildId]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO [GuildId]
</span><a href="RoleSelfAssign.html#getAssignMessageIds"><span class="hs-identifier hs-var">getAssignMessageIds</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; ReaderT DiscordHandle IO Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; ReaderT DiscordHandle IO Bool)
-&gt; Bool -&gt; ReaderT DiscordHandle IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionMessageId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186331"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; [GuildId] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[GuildId]
</span><a href="#local-6989586621679186330"><span class="hs-identifier hs-var">validMessages</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-comment">-- make sure the message being reacted is a role assignment message</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-comment">-- (prevents the config from being opened very often / every sent message)</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- | `attemptRoleAssign` handles role assignments.</span><span>
</span><span id="line-175"></span><span class="annot"><a href="RoleSelfAssign.html#attemptRoleAssign"><span class="hs-identifier hs-type">attemptRoleAssign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReactionInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span id="attemptRoleAssign"><span class="annot"><span class="annottext">attemptRoleAssign :: ReactionInfo -&gt; DiscordHandler ()
</span><a href="RoleSelfAssign.html#attemptRoleAssign"><span class="hs-identifier hs-var hs-var">attemptRoleAssign</span></a></span></span><span> </span><span id="local-6989586621679186327"><span class="annot"><span class="annottext">r :: ReactionInfo
</span><a href="#local-6989586621679186327"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679186326"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186326"><span class="hs-identifier hs-var">validMsg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; ReaderT DiscordHandle IO Bool
</span><a href="RoleSelfAssign.html#isOnAssignMessage"><span class="hs-identifier hs-var">isOnAssignMessage</span></a></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186327"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679186326"><span class="hs-identifier hs-var">validMsg</span></a></span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span>    </span><span id="local-6989586621679186325"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679186325"><span class="hs-identifier hs-var">assFileName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Text) -&gt; ReaderT DiscordHandle IO (Maybe Text)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Text) -&gt; ReaderT DiscordHandle IO (Maybe Text))
-&gt; IO (Maybe Text) -&gt; ReaderT DiscordHandle IO (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; IO (Maybe Text)
</span><a href="RoleSelfAssign.html#getRoleListIndex"><span class="hs-identifier hs-var">getRoleListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186327"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-181"></span><span>    </span><span id="local-6989586621679186323"><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186323"><span class="hs-identifier hs-var">roleMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(Text, GuildId)] -&gt; ReaderT DiscordHandle IO [(Text, GuildId)]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Text, GuildId)]
 -&gt; ReaderT DiscordHandle IO [(Text, GuildId)])
-&gt; IO [(Text, GuildId)]
-&gt; ReaderT DiscordHandle IO [(Text, GuildId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO [(Text, GuildId)]
</span><a href="RoleSelfAssign.html#getRoleMap"><span class="hs-identifier hs-var">getRoleMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679186325"><span class="hs-identifier hs-var">assFileName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186321"><span class="annot"><span class="annottext">desiredRole :: Maybe GuildId
</span><a href="#local-6989586621679186321"><span class="hs-identifier hs-var hs-var">desiredRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Text, GuildId)] -&gt; Maybe GuildId
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toUpper</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Emoji -&gt; Text) -&gt; Emoji -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Emoji -&gt; Text
</span><span class="hs-identifier hs-var hs-var">emojiName</span></span><span> </span><span class="annot"><span class="annottext">(Emoji -&gt; Text) -&gt; Emoji -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; Emoji
</span><span class="hs-identifier hs-var hs-var">reactionEmoji</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186327"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186323"><span class="hs-identifier hs-var">roleMap</span></a></span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; DiscordHandler ()) -&gt; Bool -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId
</span><a href="#local-6989586621679186321"><span class="hs-identifier hs-var">desiredRole</span></a></span><span>
</span><span id="line-184"></span><span>    </span><span class="hs-comment">-- sanity check the desired role (can't be anything other than those which</span><span>
</span><span id="line-185"></span><span>    </span><span class="hs-comment">-- are specified in the config; for example, emotePronounMap.csv)</span><span>
</span><span id="line-186"></span><span>    </span><span class="hs-comment">-- NOTE: make sure the emoji names in the config are uppercase.</span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186319"><span class="annot"><span class="annottext">newRoleId :: GuildId
</span><a href="#local-6989586621679186319"><span class="hs-identifier hs-var hs-var">newRoleId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GuildId -&gt; GuildId
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId
</span><a href="#local-6989586621679186321"><span class="hs-identifier hs-var">desiredRole</span></a></span><span>
</span><span id="line-189"></span><span>    </span><span class="annot"><span class="annottext">GuildRequest () -&gt; DiscordHandler (Either RestCallErrorCode ())
forall a (r :: * -&gt; *).
(FromJSON a, Request (r a)) =&gt;
r a -&gt; DiscordHandler (Either RestCallErrorCode a)
</span><span class="hs-identifier hs-var">restCall</span></span><span> </span><span class="annot"><span class="annottext">(GuildRequest () -&gt; DiscordHandler (Either RestCallErrorCode ()))
-&gt; GuildRequest () -&gt; DiscordHandler (Either RestCallErrorCode ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; GuildId -&gt; GuildId -&gt; GuildRequest ()
</span><span class="hs-identifier hs-var">AddGuildMemberRole</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-var">serverID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionUserId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186327"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186319"><span class="hs-identifier hs-var">newRoleId</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">GuildId -&gt; Text -&gt; DiscordHandler ()
</span><a href="Utils.html#sendMessageDM"><span class="hs-identifier hs-var">sendMessageDM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionUserId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186327"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; DiscordHandler ()) -&gt; Text -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Owoifier.html#owoify"><span class="hs-identifier hs-var">owoify</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Added your desired role! Hurray!&quot;</span></span><span>
</span><span id="line-193"></span><span>
</span><span id="line-194"></span><span class="hs-comment">-- | TODO: remove the repetition in handleRoleAssign/handleRoleRemove by</span><span>
</span><span id="line-195"></span><span class="hs-comment">-- modularizing thingies better (i.e., the sanity check).</span><span>
</span><span id="line-196"></span><span class="annot"><a href="RoleSelfAssign.html#handleRoleRemove"><span class="hs-identifier hs-type">handleRoleRemove</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReactionInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">DiscordHandler</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span id="handleRoleRemove"><span class="annot"><span class="annottext">handleRoleRemove :: ReactionInfo -&gt; DiscordHandler ()
</span><a href="RoleSelfAssign.html#handleRoleRemove"><span class="hs-identifier hs-var hs-var">handleRoleRemove</span></a></span></span><span> </span><span id="local-6989586621679186318"><span class="annot"><span class="annottext">r :: ReactionInfo
</span><a href="#local-6989586621679186318"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621679186317"><span class="annot"><span class="annottext">[GuildId]
</span><a href="#local-6989586621679186317"><span class="hs-identifier hs-var">validMessages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [GuildId] -&gt; ReaderT DiscordHandle IO [GuildId]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">IO [GuildId]
</span><a href="RoleSelfAssign.html#getAssignMessageIds"><span class="hs-identifier hs-var">getAssignMessageIds</span></a></span><span>
</span><span id="line-199"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionMessageId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186318"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; [GuildId] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><span class="hs-operator hs-var">`elem`</span></span><span> </span><span class="annot"><span class="annottext">[GuildId]
</span><a href="#local-6989586621679186317"><span class="hs-identifier hs-var">validMessages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>    </span><span class="hs-comment">-- make sure the message being reacted is a role assignment message</span><span>
</span><span id="line-201"></span><span>    </span><span class="hs-comment">-- (prevents the config from being opened very often / every sent message)</span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span><span>    </span><span id="local-6989586621679186316"><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679186316"><span class="hs-identifier hs-var">assFileName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe Text) -&gt; ReaderT DiscordHandle IO (Maybe Text)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe Text) -&gt; ReaderT DiscordHandle IO (Maybe Text))
-&gt; IO (Maybe Text) -&gt; ReaderT DiscordHandle IO (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; IO (Maybe Text)
</span><a href="RoleSelfAssign.html#getRoleListIndex"><span class="hs-identifier hs-var">getRoleListIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186318"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-204"></span><span>    </span><span id="local-6989586621679186315"><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186315"><span class="hs-identifier hs-var">roleMap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [(Text, GuildId)] -&gt; ReaderT DiscordHandle IO [(Text, GuildId)]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><span class="hs-identifier hs-var">liftIO</span></span><span> </span><span class="annot"><span class="annottext">(IO [(Text, GuildId)]
 -&gt; ReaderT DiscordHandle IO [(Text, GuildId)])
-&gt; IO [(Text, GuildId)]
-&gt; ReaderT DiscordHandle IO [(Text, GuildId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; IO [(Text, GuildId)]
</span><a href="RoleSelfAssign.html#getRoleMap"><span class="hs-identifier hs-var">getRoleMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Text -&gt; Text
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe Text
</span><a href="#local-6989586621679186316"><span class="hs-identifier hs-var">assFileName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-205"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186314"><span class="annot"><span class="annottext">desiredRole :: Maybe GuildId
</span><a href="#local-6989586621679186314"><span class="hs-identifier hs-var hs-var">desiredRole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; [(Text, GuildId)] -&gt; Maybe GuildId
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text -&gt; Text
</span><span class="hs-identifier hs-var">T.toUpper</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; Text) -&gt; (Emoji -&gt; Text) -&gt; Emoji -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Emoji -&gt; Text
</span><span class="hs-identifier hs-var hs-var">emojiName</span></span><span> </span><span class="annot"><span class="annottext">(Emoji -&gt; Text) -&gt; Emoji -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo -&gt; Emoji
</span><span class="hs-identifier hs-var hs-var">reactionEmoji</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186318"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Text, GuildId)]
</span><a href="#local-6989586621679186315"><span class="hs-identifier hs-var">roleMap</span></a></span><span>
</span><span id="line-206"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DiscordHandler ()
forall (f :: * -&gt; *). Alternative f =&gt; Bool -&gt; f ()
</span><span class="hs-identifier hs-var">guard</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; DiscordHandler ()) -&gt; Bool -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId
</span><a href="#local-6989586621679186314"><span class="hs-identifier hs-var">desiredRole</span></a></span><span>
</span><span id="line-207"></span><span>    </span><span class="hs-comment">-- sanity check the desired role (can't be anything other than those which</span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-comment">-- are specified in the config; for example, emotePronounMap.csv)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-comment">-- NOTE: make sure the emoji names in the config are uppercase.</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186313"><span class="annot"><span class="annottext">oldRoleId :: GuildId
</span><a href="#local-6989586621679186313"><span class="hs-identifier hs-var hs-var">oldRoleId</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe GuildId -&gt; GuildId
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe GuildId
</span><a href="#local-6989586621679186314"><span class="hs-identifier hs-var">desiredRole</span></a></span><span>
</span><span id="line-212"></span><span>    </span><span class="annot"><span class="annottext">GuildRequest () -&gt; DiscordHandler (Either RestCallErrorCode ())
forall a (r :: * -&gt; *).
(FromJSON a, Request (r a)) =&gt;
r a -&gt; DiscordHandler (Either RestCallErrorCode a)
</span><span class="hs-identifier hs-var">restCall</span></span><span> </span><span class="annot"><span class="annottext">(GuildRequest () -&gt; DiscordHandler (Either RestCallErrorCode ()))
-&gt; GuildRequest () -&gt; DiscordHandler (Either RestCallErrorCode ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; GuildId -&gt; GuildId -&gt; GuildRequest ()
</span><span class="hs-identifier hs-var">RemoveGuildMemberRole</span></span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="RoleSelfAssign.html#serverID"><span class="hs-identifier hs-var">serverID</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionUserId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186318"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GuildId
</span><a href="#local-6989586621679186313"><span class="hs-identifier hs-var">oldRoleId</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="annottext">GuildId -&gt; Text -&gt; DiscordHandler ()
</span><a href="Utils.html#sendMessageDM"><span class="hs-identifier hs-var">sendMessageDM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionUserId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186318"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-215"></span><span>        </span><span class="annot"><span class="annottext">(Text -&gt; DiscordHandler ()) -&gt; Text -&gt; DiscordHandler ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text
</span><a href="Owoifier.html#owoify"><span class="hs-identifier hs-var">owoify</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;Really sorry you didn't like the role, I went ahead and removed it.&quot;</span></span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="hs-comment">-- | Given a Text @dir@, `getRoleMap` parses the file in &quot;src/config&quot;,</span><span>
</span><span id="line-218"></span><span class="hs-comment">-- converting it into a dictionary. One mapping per line. The map is indicated</span><span>
</span><span id="line-219"></span><span class="hs-comment">-- by a comma separating the emoji name (in UPPERCASE) and the corresponding role</span><span>
</span><span id="line-220"></span><span class="hs-comment">-- ID. This has to be wrapped in IO.</span><span>
</span><span id="line-221"></span><span class="annot"><a href="RoleSelfAssign.html#getRoleMap"><span class="hs-identifier hs-type">getRoleMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">RoleId</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-222"></span><span id="getRoleMap"><span class="annot"><span class="annottext">getRoleMap :: Text -&gt; IO [(Text, GuildId)]
</span><a href="RoleSelfAssign.html#getRoleMap"><span class="hs-identifier hs-var hs-var">getRoleMap</span></a></span></span><span> </span><span id="local-6989586621679186312"><span class="annot"><span class="annottext">dir :: Text
</span><a href="#local-6989586621679186312"><span class="hs-identifier hs-var">dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621679186311"><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679186311"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO [[Text]]
</span><a href="CSV.html#readCSV"><span class="hs-identifier hs-var">readCSV</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO [[Text]]) -&gt; FilePath -&gt; IO [[Text]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679186312"><span class="hs-identifier hs-var">dir</span></a></span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="annottext">[(Text, GuildId)] -&gt; IO [(Text, GuildId)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([(Text, GuildId)] -&gt; IO [(Text, GuildId)])
-&gt; [(Text, GuildId)] -&gt; IO [(Text, GuildId)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-225"></span><span>        </span><span id="local-6989586621679186310"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186310"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679186311"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-226"></span><span>        </span><span class="annot"><span class="annottext">(Text, GuildId) -&gt; [(Text, GuildId)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186310"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GuildId
forall a. Read a =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; GuildId) -&gt; ([Text] -&gt; FilePath) -&gt; [Text] -&gt; GuildId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; ([Text] -&gt; [Text]) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186310"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="hs-comment">-- | Given a reaction @r@, `getRoleListIndex` parses the file &quot;src/config/idAssign&quot;.</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- Note: this is a special file that represents a dictionary. Again, one mapping per line,</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- with the map indicated by a comma separating the message ID and the corresponding role</span><span>
</span><span id="line-231"></span><span class="hs-comment">-- config file in &quot;src/config&quot;. It returns a Maybe type representing the existence of such</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- a config file for the message that is attached to the given reaction.</span><span>
</span><span id="line-233"></span><span class="annot"><a href="RoleSelfAssign.html#getRoleListIndex"><span class="hs-identifier hs-type">getRoleListIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ReactionInfo</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">T.Text</span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span id="getRoleListIndex"><span class="annot"><span class="annottext">getRoleListIndex :: ReactionInfo -&gt; IO (Maybe Text)
</span><a href="RoleSelfAssign.html#getRoleListIndex"><span class="hs-identifier hs-var hs-var">getRoleListIndex</span></a></span></span><span> </span><span id="local-6989586621679186307"><span class="annot"><span class="annottext">r :: ReactionInfo
</span><a href="#local-6989586621679186307"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-235"></span><span>    </span><span id="local-6989586621679186306"><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679186306"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO [[Text]]
</span><a href="CSV.html#readCSV"><span class="hs-identifier hs-var">readCSV</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="RoleSelfAssign.html#assignFilePath"><span class="hs-identifier hs-var">assignFilePath</span></a></span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="annottext">Maybe Text -&gt; IO (Maybe Text)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Maybe Text -&gt; IO (Maybe Text))
-&gt; ([(GuildId, Text)] -&gt; Maybe Text)
-&gt; [(GuildId, Text)]
-&gt; IO (Maybe Text)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">GuildId -&gt; [(GuildId, Text)] -&gt; Maybe Text
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><span class="hs-identifier hs-var">lookup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ReactionInfo -&gt; GuildId
</span><span class="hs-identifier hs-var hs-var">reactionMessageId</span></span><span> </span><span class="annot"><span class="annottext">ReactionInfo
</span><a href="#local-6989586621679186307"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(GuildId, Text)] -&gt; IO (Maybe Text))
-&gt; [(GuildId, Text)] -&gt; IO (Maybe Text)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-237"></span><span>        </span><span id="local-6989586621679186305"><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186305"><span class="hs-identifier hs-var">line</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679186306"><span class="hs-identifier hs-var">contents</span></a></span><span>
</span><span id="line-238"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679186304"><span class="annot"><span class="annottext">pair :: (Text, Text)
</span><a href="#local-6989586621679186304"><span class="hs-identifier hs-var hs-var">pair</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186305"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; Text) -&gt; ([Text] -&gt; [Text]) -&gt; [Text] -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; [Text]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Text]
</span><a href="#local-6989586621679186305"><span class="hs-identifier hs-var">line</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>        </span><span class="annot"><span class="annottext">(GuildId, Text) -&gt; [(GuildId, Text)]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((GuildId, Text) -&gt; [(GuildId, Text)])
-&gt; (GuildId, Text) -&gt; [(GuildId, Text)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; GuildId) -&gt; (Text, Text) -&gt; (GuildId, Text)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><span class="hs-identifier hs-var">first</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GuildId
forall a. Read a =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; GuildId) -&gt; (Text -&gt; FilePath) -&gt; Text -&gt; GuildId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text, Text)
</span><a href="#local-6989586621679186304"><span class="hs-identifier hs-var">pair</span></a></span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- | `getAssignMessageIds` returns a list of all message Snowflakes for all messages which</span><span>
</span><span id="line-242"></span><span class="hs-comment">-- represent a self assignment station. All such messages are present in &quot;src/config/idAssign&quot;,</span><span>
</span><span id="line-243"></span><span class="hs-comment">-- which is also the only file name that mustn't be edited.</span><span>
</span><span id="line-244"></span><span class="annot"><a href="RoleSelfAssign.html#getAssignMessageIds"><span class="hs-identifier hs-type">getAssignMessageIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">MessageId</span></span><span class="hs-special">]</span><span>
</span><span id="line-245"></span><span id="getAssignMessageIds"><span class="annot"><span class="annottext">getAssignMessageIds :: IO [GuildId]
</span><a href="RoleSelfAssign.html#getAssignMessageIds"><span class="hs-identifier hs-var hs-var">getAssignMessageIds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-246"></span><span>    </span><span id="local-6989586621679186303"><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679186303"><span class="hs-identifier hs-var">lines</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO [[Text]]
</span><a href="CSV.html#readCSV"><span class="hs-identifier hs-var">readCSV</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="RoleSelfAssign.html#assignFilePath"><span class="hs-identifier hs-var">assignFilePath</span></a></span><span>
</span><span id="line-247"></span><span>    </span><span class="annot"><span class="annottext">[GuildId] -&gt; IO [GuildId]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">([GuildId] -&gt; IO [GuildId]) -&gt; [GuildId] -&gt; IO [GuildId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">([Text] -&gt; GuildId) -&gt; [[Text]] -&gt; [GuildId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><span class="hs-identifier hs-var">map</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GuildId
forall a. Read a =&gt; FilePath -&gt; a
</span><span class="hs-identifier hs-var">read</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; GuildId) -&gt; ([Text] -&gt; FilePath) -&gt; [Text] -&gt; GuildId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Bool) -&gt; FilePath -&gt; FilePath
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><span class="hs-identifier hs-var">takeWhile</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Bool
</span><span class="hs-identifier hs-var">isDigit</span></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath)
-&gt; ([Text] -&gt; FilePath) -&gt; [Text] -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; FilePath
</span><span class="hs-identifier hs-var">T.unpack</span></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; FilePath) -&gt; ([Text] -&gt; Text) -&gt; [Text] -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[[Text]]
</span><a href="#local-6989586621679186303"><span class="hs-identifier hs-var">lines</span></a></span></pre></body></html>